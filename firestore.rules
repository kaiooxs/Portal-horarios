rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Regras para a coleção de dados públicos
    match /artifacts/default-app-id/public/data/{document=**} {
      // Permitir leitura para todos (autenticados ou não)
      allow read: if true;
      
      // Permitir escrita apenas para usuários autenticados
      // (todos os usuários autenticados podem escrever, incluindo anônimos)
      allow write: if request.auth != null;
    }
    
    // Regras específicas para usuários
    match /artifacts/default-app-id/public/data/users/{userId} {
      // Permitir leitura para todos autenticados
      allow read: if request.auth != null;
      
      // Permitir escrita apenas para o próprio usuário
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Regras para menus (cardápios)
    match /artifacts/default-app-id/public/data/menus/{menuId} {
      // Permitir leitura para todos
      allow read: if true;
      
      // Permitir escrita para usuários autenticados
      allow write: if request.auth != null;
    }
    
    // Regras para horários
    match /artifacts/default-app-id/public/data/schedules/{scheduleId} {
      // Permitir leitura para todos
      allow read: if true;
      
      // Permitir escrita para usuários autenticados
      allow write: if request.auth != null;
    }
    
    // Regras para disponibilidades
    match /artifacts/default-app-id/public/data/availabilities/{availabilityId} {
      // Permitir leitura para todos autenticados
      allow read: if request.auth != null;
      
      // Permitir escrita para usuários autenticados
      allow write: if request.auth != null;
    }
    
    // Regras para horas restantes
    match /artifacts/default-app-id/public/data/horasRestantes/{horasId} {
      // Permitir leitura para todos autenticados
      allow read: if request.auth != null;
      
      // Permitir escrita para usuários autenticados
      allow write: if request.auth != null;
    }
    
    // Bloquear acesso a qualquer outra coleção não especificada
    match /{document=**} {
      allow read, write: if false;
    }
  }
}